{"version":3,"file":"MultiSource.js","sources":["../src/js/MultiSource.js"],"sourcesContent":["class MultiSource extends Meister.ParserPlugin {\n\n    static get pluginName() {\n        return 'MultiSource';\n    }\n\n    isItemSupported(item) {\n        return new Promise((resolve) => {\n            if (item.type !== 'multi-source') {\n                return resolve({\n                    supported: false,\n                    errorCode: Meister.ErrorCodes.WRONG_TYPE,\n                });\n            }\n\n            return resolve({\n                supported: true,\n            });\n        });\n    }\n\n    restructureItems(sources, hasDRM = false) {\n        const restructedItems = [];\n\n        for (let i = 0; i < sources.length; i++) {\n            const source = sources[i];\n\n            const sourceHasDRM = Object.prototype.hasOwnProperty.call(source, 'drm');\n\n            if (!sourceHasDRM) {\n                source.drm = hasDRM;\n            }\n\n            restructedItems.push(source);\n        }\n\n        return restructedItems;\n    }\n\n    getItemToPlay(items) {\n        const item = items[0];\n\n        return this.meister.pluginLoader.getPluginByItem(item).then((plugin) => {\n            if (plugin.errorCode && items.length > 1) {\n                items.shift();\n                return this.getItemToPlay(items);\n            } else if (!plugin.errorCode) {\n                return item;\n            }\n\n            this.meister.error(`Could not find plugin to play type: '${item.type}'.`, 'MLTSRC-0001', { title: 'Unable to play content.'});\n            return null;\n        });\n    }\n\n    process(item) {\n        return new Promise((resolve, reject) => {\n            const hasDRM = typeof item.drmConfig === 'object';\n            item.sources = this.restructureItems(item.sources, hasDRM); // eslint-disable-line\n\n            this.getItemToPlay(item.sources).then((newItem) => {\n                if (newItem == null) {\n                    reject(item);\n                } else {\n                    if (item.metadata) {\n                        newItem.metadata = item.metadata; // eslint-disable-line\n                    }\n\n                    resolve(newItem);\n                }\n            });\n        });\n    }\n}\n\nMeister.registerPlugin(MultiSource.pluginName, MultiSource);\nexport default MultiSource;\n"],"names":["MultiSource","item","Promise","resolve","type","Meister","ErrorCodes","WRONG_TYPE","sources","hasDRM","restructedItems","i","length","source","sourceHasDRM","Object","prototype","hasOwnProperty","call","drm","push","items","meister","pluginLoader","getPluginByItem","then","plugin","errorCode","shift","getItemToPlay","error","title","reject","babelHelpers.typeof","drmConfig","restructureItems","newItem","metadata","ParserPlugin","registerPlugin","pluginName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAMA;;;;;;;;;;wCAMcC,MAAM;mBACX,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;oBACxBF,KAAKG,IAAL,KAAc,cAAlB,EAAkC;2BACvBD,QAAQ;mCACA,KADA;mCAEAE,QAAQC,UAAR,CAAmBC;qBAF3B,CAAP;;;uBAMGJ,QAAQ;+BACA;iBADR,CAAP;aARG,CAAP;;;;yCAcaK,SAAyB;gBAAhBC,MAAgB,uEAAP,KAAO;;gBAChCC,kBAAkB,EAAxB;;iBAEK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,QAAQI,MAA5B,EAAoCD,GAApC,EAAyC;oBAC/BE,SAASL,QAAQG,CAAR,CAAf;;oBAEMG,eAAeC,OAAOC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCL,MAArC,EAA6C,KAA7C,CAArB;;oBAEI,CAACC,YAAL,EAAmB;2BACRK,GAAP,GAAaV,MAAb;;;gCAGYW,IAAhB,CAAqBP,MAArB;;;mBAGGH,eAAP;;;;sCAGUW,OAAO;;;gBACXpB,OAAOoB,MAAM,CAAN,CAAb;;mBAEO,KAAKC,OAAL,CAAaC,YAAb,CAA0BC,eAA1B,CAA0CvB,IAA1C,EAAgDwB,IAAhD,CAAqD,UAACC,MAAD,EAAY;oBAChEA,OAAOC,SAAP,IAAoBN,MAAMT,MAAN,GAAe,CAAvC,EAA0C;0BAChCgB,KAAN;2BACO,OAAKC,aAAL,CAAmBR,KAAnB,CAAP;iBAFJ,MAGO,IAAI,CAACK,OAAOC,SAAZ,EAAuB;2BACnB1B,IAAP;;;uBAGCqB,OAAL,CAAaQ,KAAb,4CAA2D7B,KAAKG,IAAhE,UAA0E,aAA1E,EAAyF,EAAE2B,OAAO,yBAAT,EAAzF;uBACO,IAAP;aATG,CAAP;;;;gCAaI9B,MAAM;;;mBACH,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAU6B,MAAV,EAAqB;oBAC9BvB,SAASwB,QAAOhC,KAAKiC,SAAZ,MAA0B,QAAzC;qBACK1B,OAAL,GAAe,OAAK2B,gBAAL,CAAsBlC,KAAKO,OAA3B,EAAoCC,MAApC,CAAf,CAFoC;;uBAI/BoB,aAAL,CAAmB5B,KAAKO,OAAxB,EAAiCiB,IAAjC,CAAsC,UAACW,OAAD,EAAa;wBAC3CA,WAAW,IAAf,EAAqB;+BACVnC,IAAP;qBADJ,MAEO;4BACCA,KAAKoC,QAAT,EAAmB;oCACPA,QAAR,GAAmBpC,KAAKoC,QAAxB,CADe;;;gCAIXD,OAAR;;iBARR;aAJG,CAAP;;;;+BAtDoB;mBACb,aAAP;;;;EAHkB/B,QAAQiC;;AA2ElCjC,QAAQkC,cAAR,CAAuBvC,cAAYwC,UAAnC,EAA+CxC,aAA/C,EACA;;"}